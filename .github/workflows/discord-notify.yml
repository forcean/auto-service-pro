name: Notify Discord on Develop Push

on:
  push:
    branches:
      - develop

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord Embed Notification
        run: |
          COMMIT_COUNT=$(jq '.commits | length' "$GITHUB_EVENT_PATH")
          SHORT_SHA=$(echo "${{ github.sha }}" | cut -c1-7)
          COMMIT_URL="https://github.com/${{ github.repository }}/commit/${{ github.sha }}"

          curl -H "Content-Type: application/json" \
          -d "{
            \"username\": \"DEV - Notification\",
            \"embeds\": [{
              \"title\": \"ğŸš€ Develop Branch Updated\",
              \"url\": \"${COMMIT_URL}\",
              \"color\": 3447003,
              \"fields\": [
                { \"name\": \"ğŸ“¦ Repository\", \"value\": \"${{ github.repository }}\", \"inline\": true },
                { \"name\": \"ğŸŒ¿ Branch\", \"value\": \"develop\", \"inline\": true },
                { \"name\": \"ğŸ‘¤ Author\", \"value\": \"${{ github.actor }}\", \"inline\": true },

                { \"name\": \"ğŸ“ Commit Message\", \"value\": \"${{ github.event.head_commit.message }}\" },

                { \"name\": \"ğŸ”¢ Commits in Push\", \"value\": \"${COMMIT_COUNT}\", \"inline\": true },
                { \"name\": \"ğŸ”— Commit SHA\", \"value\": \"[\`${SHORT_SHA}\`](${COMMIT_URL})\", \"inline\": true }
              ],
              \"footer\": {
                \"text\": \"GitHub â†’ Discord | Develop Branch\"
              },
              \"timestamp\": \"$(date -u +%Y-%m-%dT%H:%M:%SZ)\"
            }]
          }" \
          ${{ secrets.DISCORD_WEBHOOK }}
