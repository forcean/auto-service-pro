<div class="min-h-screen  py-10 px-4">
  <div class="relative max-w-4xl mx-auto mb-6">
    <h2 class="text-2xl font-bold tracking-wide">
      รายละเอียดผู้ใช้งาน
    </h2>

    <div class="action-buttons">
      <button
        *ngIf="!isEditMode"
        class="action-btn edit-btn"
        (click)="toggleEdit()"
        [disabled]="!isUpdateUser"
        [class.is-disabled]="!isUpdateUser">

        <lucide-icon name="pencil" class="icon"></lucide-icon>
        <span class="label">แก้ไขข้อมูล</span>
      </button>

      <button
        class="action-btn delete-btn"
        (click)="onDelete()"
        [disabled]="!isDeleteUser"
        [class.is-disabled]="!isDeleteUser">
        <lucide-icon name="trash-2" class="icon"></lucide-icon>
        <span class="label">ลบผู้ใช้งาน</span>
      </button>
    </div>

  </div>

  <div
    class="bg-white w-full max-w-4xl mx-auto rounded-2xl p-8 shadow-xl border border-gray-100">

    <h3 class="text-xl font-semibold text-gray-800 mb-6">ข้อมูลผู้ใช้งาน</h3>

    <form [formGroup]="form" class="grid grid-cols-1 md:grid-cols-2 gap-6">

      <div class="md:col-span-2">
        <label class="block text-gray-700 font-medium mb-1">Username</label>
        <input
          type="text"
          formControlName="username"
          class="form-input-custom bg-gray-100" />
      </div>

      <div>
        <label class="block text-gray-700 mb-1">ชื่อ</label>
        <input
          type="text"
          formControlName="name"
          class="form-input-custom"
          placeholder="กรุณากรอกชื่อ"
          [class.border-error]="form.controls['name'].invalid && form.controls['name'].touched" />

        <div
          *ngIf="form.controls['name'].invalid && form.controls['name'].touched"
          class="flex items-center gap-1 error">
          <img src="assets/img/alert-icon.svg" class="alert-icon-create">
          <span>กรุณากรอกชื่อ</span>
        </div>
      </div>

      <div>
        <label class="block text-gray-700 mb-1">นามสกุล</label>
        <input
          type="text"
          formControlName="surname"
          class="form-input-custom"
          placeholder="กรุณากรอกนามสกุล"
          [class.border-error]="form.controls['surname'].invalid && form.controls['surname'].touched" />

        <div
          *ngIf="form.controls['surname'].invalid && form.controls['surname'].touched"
          class="flex items-center gap-1 error">
          <img src="assets/img/alert-icon.svg" class="alert-icon-create">
          <span>กรุณากรอกนามสกุล</span>
        </div>
      </div>

      <div>
        <label class="block text-gray-700 mb-1">บทบาท</label>
        <custom-select
          formControlName="role"
          (change)="onRoleChange()"
          [isDisabled]="!isEditMode">
          <custom-option value="ADM">Admin (ADM)</custom-option>
          <custom-option value="MNG">Manager (MNG)</custom-option>
          <custom-option value="ACC">Accountant (ACC)</custom-option>
          <custom-option value="SAL">Sale (SAL)</custom-option>
          <custom-option value="STC">Stock Controller (STC)</custom-option>
          <custom-option value="MEC">Mechanic (MEC)</custom-option>
        </custom-select>
      </div>

      <div *ngIf="mustSelectManager">
        <label class="block text-gray-700 mb-1">สังกัด Manager</label>
        <custom-select
          formControlName="managerId"
          placeholder="-- เลือก Manager --"
          [isDisabled]="!isEditMode"
          [isError]="form.controls['managerId'].invalid && form.controls['managerId'].touched">
          <custom-option *ngFor="let m of managerList" [value]="m.id">
            {{ m.firstname }} {{ m.lastname }}
          </custom-option>
        </custom-select>

        <div
          *ngIf="form.controls['managerId'].invalid && form.controls['managerId'].touched"
          class="flex items-center gap-1 error">
          <img src="assets/img/alert-icon.svg" class="alert-icon-create">
          <span>กรุณาเลือก Manager</span>
        </div>
      </div>

      <div>
        <label class="block text-gray-700 mb-1">อีเมล</label>
        <input
          type="email"
          formControlName="email"
          class="form-input-custom"
          placeholder="กรุณากรอกอีเมล"
          (input)="validateEmail($event)"
          [class.border-error]="isMatchEmail" />

        <div *ngIf="isMatchEmail" class="flex items-center gap-1 error">
          <img src="assets/img/alert-icon.svg" class="alert-icon-create">
          <span>อีเมลไม่ถูกต้อง</span>
        </div>
      </div>

      <div>
        <label class="block text-gray-700 mb-1">หมายเลขโทรศัพท์</label>
        <input
          type="text"
          formControlName="phoneNumber"
          class="form-input-custom"
          appNumeric
          placeholder="กรุณากรอกหมายเลขโทรศัพท์"
          [maxlength]="checkMobileLength()"
          (input)="checkMobileNoInvalid()"
          [class.border-error]="isMobileNoInvalid" />

        <div *ngIf="isMobileNoInvalid" class="flex items-center gap-1 error">
          <img src="assets/img/alert-icon.svg" class="alert-icon-create">
          <span>หมายเลขโทรศัพท์ไม่ถูกต้อง</span>
        </div>
      </div>
    </form>
    <div class="mt-10 border-t pt-6">
      <h3 class="text-xl font-semibold text-gray-800 mb-6">ข้อมูลระบบ</h3>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

        <div>
          <label class="block text-gray-700 mb-1">สร้างเมื่อ</label>
          <input class="form-input-custom bg-gray-100"
            [value]="form.value.createdDt | date:'dd/MM/yyyy HH:mm'"
            disabled />
        </div>

        <div>
          <label class="block text-gray-700 mb-1">สร้างโดย</label>
          <input class="form-input-custom bg-gray-100"
            [value]="form.value.createdBy"
            disabled />
        </div>

        <div
          *ngIf="(form.value.updatedDt)!== null && (form.value.updatedDt)!== undefined">
          <label class="block text-gray-700 mb-1">แก้ไขล่าสุด</label>
          <input class="form-input-custom bg-gray-100"
            [value]="form.value.updatedDt | date:'dd/MM/yyyy HH:mm'"
            disabled />
        </div>

        <div
          *ngIf="(form.value.updatedBy)!== null && (form.value.updatedBy)!== undefined">
          <label class="block text-gray-700 mb-1">แก้ไขโดย</label>
          <input class="form-input-custom bg-gray-100"
            [value]="form.value.updatedBy"
            disabled />
        </div>

        <div>
          <label class="block text-gray-700 mb-1">สถานะผู้ใช้งาน </label>
          <span
            class="inline-flex px-3 py-1 rounded-full text-sm font-medium"
            [ngClass]="{
          'bg-green-100 text-green-700': form.value.activeFlag,
          'bg-red-100 text-red-700': !form.value.activeFlag
        }">
            {{ form.value.activeFlag ? 'ใช้งานอยู่' : 'ปิดการใช้งาน' }}
          </span>
        </div>
      </div>
    </div>

    <div *ngIf="isEditMode" class="pt-8 flex gap-3">
      <button
        type="button"
        class="w-full bg-gray-200 hover:bg-gray-300 py-3 rounded-2xl font-medium"
        (click)="onCancelEdit()">
        ยกเลิก
      </button>

      <button
        type="button"
        class="w-full bg-yellow-400 hover:bg-yellow-500 py-3 rounded-2xl font-semibold"
        (click)="onSubmit()">
        บันทึกข้อมูล
      </button>
    </div>

  </div>
</div>

<app-modal-condition
  (onConfirm)="handleOnModalConfirm($event)"
  [isLoading]="isLoadingDelete">
</app-modal-condition>
